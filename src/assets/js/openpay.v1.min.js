(function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=n}for(var a in e)t.call(e,a)&&(n[a]=e[a]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=this;this.OpenPay=function(){function e(){}return e.version=1,e.sandboxMode=!1,e.developMode=!1,e.hostname="https://api.openpay.mx/v1/",e.sandboxHostname="https://sandbox-api.openpay.mx/v1/",e.developHostname="https://dev-api.openpay.mx/v1/",e.setSandboxMode=function(t){e.sandboxMode=t?!0:!1,t&&(e.developMode=!1)},e.getSandboxMode=function(){return e.sandboxMode},e.setDevelopMode=function(t){e.developMode=t?!0:!1,t&&(e.sandboxMode=!1)},e.getDevelopMode=function(){return e.developMode},e.setId=function(t){e.id=t},e.getId=function(){return e.id},e.setApiKey=function(t){e.key=t},e.getApiKey=function(){return e.key},e.log=function(e){"object"==typeof e&&"toString"in e&&(e=e.toString()),"undefined"!=typeof console&&"log"in console&&console.log(e)},e.validate=function(e,t){if(!e)throw t+" required";if("object"!=typeof e)throw t+" invalid"},e.formatData=function(e,t){return e},e.extractFormInfo=function(e){var t,n,r,a,o=function(e){return window.jQuery&&e instanceof jQuery?e[0]:e.nodeType&&1===e.nodeType?e:document.getElementById(e)},i=function(e,t){var n,r,a=[],o=e.children;for(r=0;r<o.length;r++)n=o[r],1===n.nodeType&&n.attributes[t]?a.push(n):n.children.length>0&&(a=a.concat(i(n,t)));return a},u=function(e,t){for(var n={},r=0;r<e.length;r++)fieldName=e[r].attributes[t].value,inputValue=e[r].value,void 0!==n[fieldName]?(n[fieldName].push||(n[this.name]=[n[this.name]]),n[fieldName].push(inputValue||"")):n[fieldName]=inputValue||"";return n};return e=o(e),t=i(e,"data-openpay-card"),n=u(t,"data-openpay-card"),a=i(e,"data-openpay-card-address"),void 0!==a&&a.length&&a.length>0&&(r=u(a,"data-openpay-card-address"),void 0!==r&&(n.address=r)),n},e.send=function(t,n,r,a){function o(e){var t=e+":",n=btoa(t);return n}function i(e,t,n){clearTimeout(p);var r=null;e=e||"Unknown error",t=t||0,n=n||"{}";try{r=JSON.parse(n)}catch(o){e="Response error"}a({message:e,status:t,data:r,toString:function(){return this.message+" [status "+this.status+"]"}})}function u(){return s(window,"XMLHttpRequest")?new XMLHttpRequest:void 0}function s(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function c(){if("undefined"!=typeof d.readyState&&4==d.readyState||!y)if(clearTimeout(p),d.status<200||d.status>=300)i("Request error",d.status,d.responseText);else{var e;try{e=JSON.parse(d.responseText)}catch(t){i("Response error (JSON parse failed)",d.status,"{}")}r({data:e,status:200})}}var d=null,p=null,l="",f="",h={},g=0,m="";if("undefined"==typeof e.id||!/^[a-z0-9]+$/i.test(e.id))return void i("Empty or invalid OpenPay ID");if("undefined"==typeof e.key||!/^pk_[a-z0-9]+$/i.test(e.key))return void i("Empty or invalid OpenPay API Key");if("function"!=typeof r&&(r=e.log),"function"!=typeof a&&(a=e.log),"undefined"==typeof JSON)return void i("Browser error (JSON library not found)");g=4e4,m=o(e.key),l=e.sandboxMode?e.sandboxHostname:e.developMode?e.developHostname:e.hostname,l=l+e.id+"/"+t;var y=XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;if(y){if(!(d=u()))return void i("Browser error (CORS not supported)");f=JSON.stringify(n),h={Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+m},d.open("POST",l,!0),"withCredentials"in d&&(d.withCredentials=!0);for(var v in h)h.hasOwnProperty(v)&&h[v]&&"setRequestHeader"in d&&d.setRequestHeader(v,h[v]);"onreadystatechange"in d?d.onreadystatechange=c:"onload"in d&&"onerror"in d&&(d.onload=c,d.onerror=i),p=setTimeout(function(){"onload"in d?d.onload=Function.prototype:d.onreadystatechange=Function.prototype,d.abort(),d=null,i("Timeout after "+g+" milliseconds")},g),d.send(f)}else{if("undefined"==typeof XDomainRequest)return void i("Browser error (CORS not supported)");n.apiKey=m;var c=function(e){e.error?i("Request error",e.httpStatus,JSON.stringify(e)):r({data:e.data,status:200})},b={callbackName:"getResultData",onSuccess:c,onError:i,timeout:g,url:l+"/jsonp",data:n};$jsonp.send(b)}},e}.call(this),e=this.OpenPay,this.OpenPay.card=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return n(t,r),r.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)&&e.length>=10&&e.length<=16&&r.luhnCheck(e)&&r.validateCardNumberLength(e)&&r.validateAcceptCardNumber(e)},r.validateCVC=function(t,n){switch(arguments.length){case 1:return t=e.utils.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4;case 2:var a=r.cardType(n);return"American Express"==a?(t=e.utils.trim(t),/^\d+$/.test(t)&&4==t.length):(t=e.utils.trim(t),/^\d+$/.test(t)&&3==t.length);default:return!1}},r.validateExpiry=function(t,n){var r,a;return t=e.utils.trim(t),n=e.utils.trim(n),/^\d+$/.test(t)&&/^\d+$/.test(n)&&parseInt(t,10)<=12&&parseInt(t,10)>=1?(a=new Date(n,t),r=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>r):!1},r.validateCardNumberLength=function(e){var t=null;if(t=r.cardAbstract(e))for(var n=t.length.length;n--;)if(t.length[n]==e.length)return!0;return!1},r.validateAcceptCardNumber=function(e){var t=null;return(t=r.cardAbstract(e))?t.accept:!1},r.luhnCheck=function(e){for(var t=(e+"").split(""),n=0,r=parseInt(t[e.length-1]),a=t.length-2,o=1;a>=0;a--,o++)n=parseInt(t[a]),o%2!=0&&(n*=2,n>9&&(n-=9)),r+=n;return r%10==0},r.cardType=function(e){var t=null;return(t=r.cardAbstract(e))?t.name:""},r.cardTypes=function(){return{visa_electron:{name:"Visa Electron",regx:/^(4026|417500|4508|4844|491(3|7))/,length:[16],accept:!0},visa:{name:"Visa",regx:/^4/,length:[16],accept:!0},mastercard:{name:"Mastercard",regx:/^5[1-5]/,length:[16],accept:!0},amex:{name:"American Express",regx:/^3[47]/,length:[15],accept:!0},diners_cb:{name:"Diners Club Carte Blanche",regx:/^30[0-5]/,length:[14],accept:!1},diners_int:{name:"Diners Club International",regx:/^36/,length:[14],accept:!1},jcb:{name:"JCB",regx:/^35(2[89]|[3-8][0-9])/,length:[16],accept:!1},laser:{name:"Laser",regx:/^(6304|670[69]|6771)/,length:[16,17,18,19],accept:!1},maestro:{name:"Maestro",regx:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19],accept:!1},discover:{name:"Discover",regx:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16],accept:!1}}},r.cardAbstract=function(e){var t={};t=r.cardTypes();for(var n in t)if(_cardObj=t[n],e.match(_cardObj.regx))return _cardObj;return!1},r}.call(this,this.OpenPay),this.OpenPay.token=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return n(t,r),r.whitelistedAttrs=["card_number","holder_name","cvv2","expiration_month","expiration_year","address"],r.extractFormAndCreate=function(t,n,a,o){var i=e.extractFormInfo(t);return r.create(i,n,a)},r.create=function(t,n,a){var o="tokens";return e.validate(t,"tarjeta"),e.formatData(t,r.whitelistedAttrs),e.send(o,t,n,a)},r}.call(this,this.OpenPay),this.OpenPay.utils=function(e){function t(){}return n(e,t),t.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},t.underscoreKeys=function(e){var t,n;n=[];for(var r in e)t=e[r],delete e[r],n.push(e[this.underscore(r)]=t);return n},t.isElement=function(e){return"object"!=typeof e?!1:"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery?!0:1===e.nodeType},t}.call(this,this.OpenPay),"undefined"!=typeof module&&null!==module&&(module.exports=this.OpenPay),"function"==typeof define&&define("openpay",[],function(){return r.OpenPay})}).call(this);var base64={};base64.PADCHAR="=",base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(e){var t=new Error("DOM Exception 5");return t.code=t.number=5,t.name=t.description="INVALID_CHARACTER_ERR",t.toString=function(){return"Error: "+t.name+": "+t.message},t}},base64.getbyte64=function(e,t){var n=base64.ALPHA.indexOf(e.charAt(t));if(-1===n)throw base64.makeDOMException();return n},base64.decode=function(e){e=""+e;var t,n,r,a=base64.getbyte64,o=e.length;if(0===o)return e;if(o%4!==0)throw base64.makeDOMException();t=0,e.charAt(o-1)===base64.PADCHAR&&(t=1,e.charAt(o-2)===base64.PADCHAR&&(t=2),o-=4);var i=[];for(n=0;o>n;n+=4)r=a(e,n)<<18|a(e,n+1)<<12|a(e,n+2)<<6|a(e,n+3),i.push(String.fromCharCode(r>>16,r>>8&255,255&r));switch(t){case 1:r=a(e,n)<<18|a(e,n+1)<<12|a(e,n+2)<<6,i.push(String.fromCharCode(r>>16,r>>8&255));break;case 2:r=a(e,n)<<18|a(e,n+1)<<12,i.push(String.fromCharCode(r>>16))}return i.join("")},base64.getbyte=function(e,t){var n=e.charCodeAt(t);if(n>255)throw base64.makeDOMException();return n},base64.encode=function(e){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var t,n,r=base64.PADCHAR,a=base64.ALPHA,o=base64.getbyte,i=[];e=""+e;var u=e.length-e.length%3;if(0===e.length)return e;for(t=0;u>t;t+=3)n=o(e,t)<<16|o(e,t+1)<<8|o(e,t+2),i.push(a.charAt(n>>18)),i.push(a.charAt(n>>12&63)),i.push(a.charAt(n>>6&63)),i.push(a.charAt(63&n));switch(e.length-u){case 1:n=o(e,t)<<16,i.push(a.charAt(n>>18)+a.charAt(n>>12&63)+r+r);break;case 2:n=o(e,t)<<16|o(e,t+1)<<8,i.push(a.charAt(n>>18)+a.charAt(n>>12&63)+a.charAt(n>>6&63)+r)}return i.join("")},function(){window.btoa||(window.btoa=base64.encode),window.atob||(window.atob=base64.decode)}();var $jsonp=function(){var e={};return e.send=function(e){var t=(new Date).getTime(),n=e.callbackName||"callback",r=e.onSuccess||function(){},a=e.onError||function(){},o=e.timeout||4e3,i=e.url||"",u=e.data||{};dataIdName="idData";var s=encodeURIComponent;u.callback="var "+dataIdName+"="+ ++t+";"+n,window[dataIdName]=void 0;var c=function(e){return e=e.replace(/[\-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""}),e.replace(/^([A-Z])/,function(e,t){return t?t.toLowerCase():""})},d=function(e,t,n){var r,a;null==t&&(t=[]);for(r in e)a=e[r],n&&(r=""+n+"."+r),"object"==typeof a?d(a,t,r):t.push(c(""+r)+"="+s(a));return t.join("&").replace(/%20/g,"+")};timeout_trigger=window.setTimeout(function(){window[n]=function(){},a("Timeout after "+o+" milliseconds")},o);var p=document.createElement("script");p.type="text/javascript",p.async=!0,p.src=i+"?"+d(u);var l=function(){var e;null!=(e=p.parentNode)&&e.removeChild(p)},f=function(){window.clearTimeout(timeout_trigger),l(),a("There was an error, please verify your authentication data or conection.")};"onreadystatechange"in p?p.onreadystatechange=function(){"loaded"==p.readyState&&"undefined"==typeof window[dataIdName]&&f()}:"onerror"in p&&(p.onerror=function(){f()}),window[n]=function(e){window.clearTimeout(timeout_trigger),l(),r(e)},document.getElementsByTagName("head")[0].appendChild(p)},e}();!function(e){"undefined"!=typeof e&&(e.fn.cardNumberInput=function(){return e(this).restrictedInput("card")},e.fn.numericInput=function(){return e(this).restrictedInput("numeric")},e.fn.restrictedInput=function(t){var n=e(this),r=[{type:"amex",regex:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:15},{type:"other",format:/(\d{1,4})/g,length:16}],a=function(e){var t,n;for(e=(e+"").replace(/\D/g,""),n=0;n<r.length;n++)if(t=r[n],t.regex&&t.regex.test(e))return t},o=function(e){var t;return e.metaKey||e.ctrlKey?!0:0===e.which?!0:32===e.which?!1:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},i=function(t){var n,r,i=e(t.currentTarget),u=(i.val()+String.fromCharCode(t.which)).replace(/\D/g,"");return r=o(t),n=a(u),n?r&&u.length<=n.length:r&&u.length<=16},u=function(t){var n=e(t.currentTarget),r=n.val();if(8===t.which)return/\d\s$/.test(r)?(t.preventDefault(),setTimeout(function(){return n.val(r.replace(/\d\s$/,""))})):/\s\d?$/.test(r)?(t.preventDefault(),setTimeout(function(){return n.val(r.replace(/\s\d?$/,""))})):void 0},s=function(t){var n,r=e(t.currentTarget),o=r.val(),i=String.fromCharCode(t.which),u=(o.replace(/\D/g,"")+i).length,s=16,c=a(o+i);if(/^\d+$/.test(i)&&(c&&(s=c.length),!(u>=s)))return n=c&&"amex"===c.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,n.test(o)?(t.preventDefault(),setTimeout(function(){return r.val(o+" "+i)})):n.test(o+i)?(t.preventDefault(),setTimeout(function(){return r.val(o+i+" ")})):void 0};return"card"===t?n.on("keypress",i).on("keypress",s).on("keydown",u).on("paste",i).on("paste",s).on("change",s).on("input",s):"numeric"===t&&n.on("keypress",o).on("paste",o).on("change",o).on("input",o),this})}(jQuery);